---
title: "Plotting Posterior median of grff"
author: "Cecile Meier-Scherling"
date: "`r Sys.Date()`"
output: 
  html_document: 
    code_folding: hide 
    fig_width: 8
    fig_height: 6
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

# devtools::install_github("malaria-atlas-project/malariaAtlas")

library(ggplot2)
library(raster)
library(terra)
library(dplyr)
library(sf)
library(viridis)
```

Loading grff data
```{r load data}
grff_draws <- readRDS("data_derived/GRFF_draws_example.rds")
grff_summary <- readRDS("data_derived/GRFF_summary_example.rds")
```

Convert dataframe to raster
```{r convert df to sf object}
# Convert dataframe to sf object
sf_grff_summary <- st_as_sf(grff_summary, coords = c("lon", "lat"), crs=4326)

# Rasterize the sf object
raster_Q2.5 <- create_raster_object(sf_grff_summary, "prev_Q2.5", res = 0.1)
raster_Q50 <- create_raster_object(sf_grff_summary, "prev_Q50", res = 0.1)
raster_Q97.5 <- create_raster_object(sf_grff_summary, "prev_Q97.5", res = 0.1)
raster_sd <- create_raster_object(sf_grff_summary, "prev_sd", res = 0.1)

# Stack the Rasters Together
raster_grff_summary <- c(raster_Q2.5, raster_Q50, raster_Q97.5, raster_sd)
```

Plot rasters
```{r map Q50}
#plot_spatiotemporal
plot_spatiotemporal_map_raster(raster_grff_summary, names(raster_grff_summary))

```
